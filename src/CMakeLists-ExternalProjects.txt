include(ExternalProject)

ExternalProject_Add(
  document-graph

  GIT_REPOSITORY "https://github.com/hypha-dao/document-graph.git"
  GIT_TAG "5d6f03e1903bdb727e3a1a8ed2790fee7e251de7"

  INSTALL_COMMAND ""
  UPDATE_COMMAND ""
  PATCH_COMMAND ""

  SOURCE_DIR "${CMAKE_SOURCE_DIR}/deps/document-graph"
  CMAKE_ARGS -DBuildShared=ON -DBuildExamples=OFF

  TEST_COMMAND ""
)

set(PARENT_PROJECT_BINARY_DIR ${PROJECT_BINARY_DIR})
ExternalProject_Get_Property(document-graph BINARY_DIR)

ExternalProject_Add_Step(
  document-graph CopyToBin
  COMMAND ${CMAKE_COMMAND} -E copy_directory ${BINARY_DIR}/docs ${PARENT_PROJECT_BINARY_DIR}
  DEPENDEES install
  BYPRODUCTS ${PARENT_PROJECT_BINARY_DIR}/docs.wasm
)

set(document_graph_INCLUDE_DIRS "${CMAKE_SOURCE_DIR}/deps/document-graph/include")
set(document_graph_LIBRARIES "${CMAKE_SHARED_LIBRARY_PREFIX}document_graph{CMAKE_SHARED_LIBRARY_SUFFIX}")
include_directories(${document_graph_INCLUDE_DIRS})